# Dockerfile for building iMCAr executables with GLIBC 2.31 compatibility
# Based on Ubuntu 20.04 for backward compatibility with older Linux distributions

FROM ubuntu:20.04

# Prevent interactive prompts during package installation
ENV DEBIAN_FRONTEND=noninteractive
ENV TZ=Europe/Berlin

# Install system dependencies including Python 3.10 and required XCB libraries
RUN apt-get update && apt-get install -y \
    # Build essentials
    git \
    curl \
    zip \
    # Python 3.10 and pip
    software-properties-common \
    && add-apt-repository ppa:deadsnakes/ppa \
    && apt-get update \
    && apt-get install -y \
    python3.10 \
    python3.10-distutils \
    python3-pip \
    # XCB libraries required for Qt xcb platform plugin
    libxcb-icccm4 \
    libxcb-image0 \
    libxcb-keysyms1 \
    libxcb-render-util0 \
    libxcb-xinerama0 \
    libxcb-xkb1 \
    libxcb-shape0 \
    libxkbcommon-x11-0 \
    # Cleanup
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Ensure python3.10 is available as python3
RUN update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.10 1

# Upgrade pip for Python 3.10
RUN python3.10 -m pip install --upgrade pip setuptools wheel

# Set working directory
WORKDIR /workspace

# Default command
CMD ["/bin/bash"]
